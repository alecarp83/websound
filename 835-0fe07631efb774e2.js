!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b52f33db-0399-47cd-9fd7-16cd825fe4f3",e._sentryDebugIdIdentifier="sentry-dbid-b52f33db-0399-47cd-9fd7-16cd825fe4f3")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[835],{59264:function(e,t,a){a.d(t,{A:function(){return r}});let r=(0,a(85922).k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",17)},17363:function(e,t,a){a.d(t,{CQ:function(){return m},E7:function(){return c},LP:function(){return h},S7:function(){return u},qM:function(){return f}});var r=a(75005),n=a(77362),s=a(87601),l=a(18151),o=a(58078),i=a(17344),d=a(61153);function u(){var e;let t=(0,r.$)(),a=(0,d.BO)();return(0,n.useQuery)({queryKey:[null!==(e=null==a?void 0:a.id)&&void 0!==e?e:"","bookmarks"],queryFn:async()=>{var e;let{data:r}=await t.from("bookmark").select("*").order("updated_at",{ascending:!1}).eq("owner_id",null!==(e=null==a?void 0:a.id)&&void 0!==e?e:"");return r},enabled:!!a})}function c(e){let t=(0,r.$)(),a=(0,o.useContext)(i.Ec);return(0,n.useQuery)({queryKey:["pageBookmarks",e],queryFn:async()=>{let{data:r}=await t.from("bookmark").select("*").order("updated_at",{ascending:!1}).eq("site_id",e).eq("owner_id",a.id);return r},enabled:!!e&&!!a})}function m(){let e=(0,r.$)(),t=(0,s.useQueryClient)(),a=(0,o.useContext)(i.Ec);return(0,l.useMutation)({mutationFn:async t=>{let{id:a,...r}=t,{error:n,data:s}=await e.from("bookmark").update(r).eq("id",a).select("*").single();if(n)throw n;return s},onSuccess:async e=>{if(!a)throw Error("User must be logged in to update bookmark");return t.setQueryData(["bookmark",e.id],e),t.setQueryData([a.id,"bookmarks"],t=>t?[e,...t.filter(t=>t.id!==e.id)]:[e]),t.setQueryData(["pageBookmarks",e.site_id],t=>t?[e,...t.filter(t=>t.id!==e.id)]:[e]),e}})}function f(){let e=(0,r.$)(),t=(0,s.useQueryClient)(),a=(0,o.useContext)(i.Ec);return(0,l.useMutation)({mutationFn:async t=>{let{error:a,data:r}=await e.from("bookmark").insert(t).select("*").single();if(a)throw a;return r},onSuccess:async e=>{var r;return t.setQueryData(["bookmark",e.id],e),t.setQueryData([null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"","bookmarks"],t=>t?[e,...t]:[e]),t.setQueryData(["pageBookmarks",e.site_id],t=>t?[e,...t]:[e]),e}})}function h(){let e=(0,r.$)(),t=(0,s.useQueryClient)(),a=(0,o.useContext)(i.Ec);return(0,l.useMutation)({mutationFn:async t=>{let{error:a}=await e.from("bookmark").delete().eq("id",t);if(a)throw a;return t},onSuccess:async e=>{var r;t.setQueryData(["bookmark",e],void 0),t.setQueryData([null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"","bookmarks"],t=>t?t.filter(t=>t.id!==e):[]),t.setQueriesData({predicate:e=>"pageBookmarks"===e.queryKey[0]},t=>{if(t)return t.filter(t=>t.id!==e)})}})}},98448:function(e,t,a){a.d(t,{k:function(){return d},t:function(){return i}});var r=a(75005),n=a(17344),s=a(58078),l=a(87601),o=a(77362);function i(){let e=(0,l.useQueryClient)();return(0,s.useCallback)(t=>{e.setQueryData(["history"],e=>e?[t,...e]:[t])},[e])}function d(){let e=(0,r.$)(),t=(0,s.useContext)(n.Ec);return(0,o.useQuery)({queryKey:[t.id,"history"],queryFn:async()=>{let{data:a,error:r}=await e.from("sites").select("id, title, url, method, command, created_at").eq("user_id",null==t?void 0:t.id).order("created_at",{ascending:!1});if(r)throw r;return a},enabled:!!t})}},84971:function(e,t,a){a.d(t,{Zr:function(){return p},zI:function(){return b}});var r=a(37821),n=a(78781),s=a(58078),l=a(75005),o=a(82813),i=a(22577),d=a(9799),u=a(7268),c=a(77362),m=a(14233),f=a(90168),h=a(56942),x=a(80389);function p(){let e=(0,f.useSearchParams)(),t=!!e.get("settings"),[a,l]=(0,s.useState)("/default_avatar.png"),[o,i]=(0,s.useState)("/default_avatar.png"),[d,u]=(0,s.useState)(""),[c,m]=(0,s.useState)(""),h=(0,f.useRouter)(),x=(0,f.usePathname)(),p=(0,s.useCallback)((t,a)=>{let r=new URLSearchParams(e.toString());return a?r.set(t,a):r.delete(t),r.toString()},[e]),b=(0,s.useCallback)(e=>{h.push(x+"?"+p("settings",e?"open":void 0))},[]);return(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/profile",{method:"GET",headers:{"Content-Type":"application/json"}}),t=await e.json();if(t.error){console.error("Error fetching profile:",t.error.message);return}l((null==t?void 0:t.avatar_url)||"/default_avatar.png"),i((null==t?void 0:t.avatar_url)||"/default_avatar.png"),u(t.username),m(t.username)}catch(e){console.error("Error fetching profile:",e)}})()},[]),(0,r.jsx)(n.Vq.Root,{open:t,onOpenChange:b,children:(0,r.jsx)(n.Vq.Content,{maxWidth:"450px",children:(0,r.jsx)(g,{savedAvatarUrl:a,avatarUrl:o,setAvatarUrl:i,savedUsername:d,username:c,setUsername:m,setOpen:b})})})}function b(){let[e,t]=(0,s.useState)("/default_avatar.png"),a=(0,f.useSearchParams)(),n=(0,f.useRouter)(),l=(0,f.usePathname)(),o=(0,s.useCallback)((e,t)=>{let r=new URLSearchParams(a.toString());return t?r.set(e,t):r.delete(e),r.toString()},[a]);return(0,s.useCallback)(e=>{n.push(l+"?"+o("settings",e?"open":void 0))},[]),(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/profile",{method:"GET",headers:{"Content-Type":"application/json"}}),a=await e.json();if(a.error){console.error("Error fetching profile:",a.error.message);return}t((null==a?void 0:a.avatar_url)||"/default_avatar.png")}catch(e){console.error("Error fetching profile:",e)}})()},[]),(0,r.jsx)(m.default,{href:l+"?"+o("settings","open"),className:"relative p-2",children:(0,r.jsx)("img",{src:e,alt:"User Avatar",className:"w-6 h-6 rounded-full border border-1 border-white dark:border-neutral-600",onError:e=>{"/default_avatar.png"!==e.target.src&&(e.target.src="/default_avatar.png")}})})}function g(e){var t;let{savedAvatarUrl:a,avatarUrl:l,setAvatarUrl:m,savedUsername:f,username:p,setUsername:b,setOpen:g}=e,j=(0,h.Pi)(),k=(0,h.rV)(),w=(0,h.eP)(),[N,_]=(0,s.useState)(null!==(t=null==k?void 0:k.model)&&void 0!==t?t:"sonnet"),[C,S]=(0,s.useState)(j),E=async()=>{w({model:N,usage_refresh_emails:null==k?void 0:k.usage_refresh_emails}),(0,h.Lb)(C);try{let e=l;if(l.startsWith("data:")){let t=await fetch("/api/avatar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataUrl:l})});e=(await t.json()).data.url}let t={avatar_url:e,username:p};await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),g(!1)}catch(e){console.error("Error updating profile:",e),alert("Error updating profile. Please try again.")}},q=(0,c.useQuery)({queryKey:["username",p],queryFn:async()=>p.length<3||f===p?null:(await fetch("/api/profile/".concat(p),{method:"GET",headers:{"Content-Type":"application/json"}})).json()}),Q=q.isLoading||!!q.data||!/^[a-zA-Z0-9_]{3,32}$/.test(p);return(0,r.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:e=>{e.preventDefault(),Q||E()},children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"flex items-center text-2xl font-bold gap-4",children:[(0,r.jsx)(i.Z,{className:"w-6 h-6"}),"Profile"]}),(0,r.jsx)("button",{type:"button",onClick:v,className:"text-gray-500 text-sm py-2 hover:opacity-70 dark:text-neutral-400",children:"Logout"})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-col",children:[(0,r.jsx)("label",{htmlFor:"avatar-upload",className:"block mb-2",children:"Avatar:"}),(0,r.jsx)("img",{src:l,alt:"Avatar",className:"w-20 h-20 rounded-full mb-2"}),(0,r.jsx)("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){let e=new FileReader;e.onload=()=>{m(e.result)},e.readAsDataURL(a)}},className:"inset-0 text-xs"})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-row justify-between items-start",children:[(0,r.jsx)("label",{htmlFor:"username",className:"block leading-10",children:"Username:"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{type:"text",id:"username",value:p,onChange:e=>b(e.target.value),minLength:3,maxLength:32,pattern:"^[a-zA-Z0-9_]{3,32}$",className:" border border-gray-300 rounded-md px-3 py-2 dark:border-neutral-700 dark:bg-neutral-800 user-invalid:border-red-500 "}),q.data?(0,r.jsxs)("div",{className:"text-xs text-red-500",children:['Username "',p,'" is already taken']}):null,(0,r.jsx)("div",{className:["text-xs",p.length<3||p.length>32?"text-red-500":"text-green-600"].join(" "),children:"Between 3 and 32 characters"}),(0,r.jsx)("div",{className:["text-xs",/^[a-zA-Z0-9_]*$/.test(p)?"text-green-600":"text-red-500"].join(" "),children:"Only letters, numbers, and underscores"})]})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-row justify-between items-center",children:[(0,r.jsx)("label",{htmlFor:"dark",className:"block",children:"Dark Mode:"}),(0,r.jsx)(x.r,{defaultChecked:(0,s.useMemo)(()=>document.documentElement.classList.contains("dark"),[]),onChange:e=>{let t=e.target.checked;t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),document.cookie="nosleep=".concat(t,"; path=/; max-age=").concat(2147483648-1)}})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-row justify-between items-center",children:[(0,r.jsx)("label",{htmlFor:"dark",className:"block",children:"Get emailed when your usage limit has been refreshed:"}),(0,r.jsx)(x.r,{defaultChecked:!!k.usage_refresh_emails,onChange:e=>{w({usage_refresh_emails:e.target.checked,model:null})}})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsxs)(o.pJ,{children:[(0,r.jsxs)(o.lG,{className:"group flex items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"flex items-center text-2xl font-bold gap-4 group-data-[open]:mb-4 mb-8",children:[(0,r.jsx)(d.Z,{className:"w-6 h-6"}),"Settings"]}),(0,r.jsx)(u.Z,{className:"w-6 h-6 group-data-[open]:rotate-180 group-data-[open]:mb-4 mb-8"})]}),(0,r.jsx)(o.V2,{className:"data-[open]:mb-8 mb-0",children:(0,r.jsx)(y,{model:N,setModel:_,apiKey:C,setApiKey:S})})]})}),(0,r.jsx)("div",{className:"flex justify-between",children:(0,r.jsxs)("div",{className:"flex-1 flex justify-end",children:[(0,r.jsx)(n.Vq.Close,{children:(0,r.jsx)("button",{type:"button",className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md mr-2",onClick:()=>{b(f),m(a)},children:"Cancel"})}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md disabled:opacity-50",disabled:Q,children:"Save Changes!"})]})})]})}function y(e){let{model:t,setModel:a,apiKey:n,setApiKey:s}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("label",{htmlFor:"model",children:"Default Model"}),(0,r.jsxs)("select",{value:t||"",id:"model",className:"border border-gray-300 rounded-md px-3 py-2 dark:border-neutral-700 dark:bg-neutral-800",onChange:e=>{a(e.target.value)},children:[(0,r.jsx)("option",{value:"haiku",children:"Haiku"}),(0,r.jsx)("option",{value:"sonnet",children:"Sonnet (3.5)"}),(0,r.jsx)("option",{value:"opus",children:"Opus"}),(0,r.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,r.jsx)("option",{value:"claude-3-sonnet",children:"Sonnet (3)"})]})]}),(0,r.jsx)("div",{className:"flex items-center justify-between mb-4"}),(0,r.jsxs)("div",{className:"flex justify-between mb-4 flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4 flex-1",children:[(0,r.jsx)("label",{htmlFor:"apiKey",children:"Custom API Key"}),(0,r.jsx)("input",{type:"text",className:"border border-gray-300 rounded-md px-3 py-2 dark:border-neutral-700 dark:bg-neutral-800",placeholder:"Optional",defaultValue:n,onChange:e=>{e.target.value?s(e.target.value):s(void 0)}})]}),(0,r.jsxs)("div",{className:"text-xs",children:["Use either an"," ",(0,r.jsx)("a",{href:"https://openrouter.ai",className:"text-blue-500 hover:text-blue-700",target:"_blank",children:"OpenRouter"})," ","or"," ",(0,r.jsx)("a",{href:"https://anthropic.com",className:"text-blue-500 hover:text-blue-700",target:"_blank",children:"Anthropic"})," ","API Key. We recommend OpenRouter as it has less rate limiting."]})]})]})}async function v(){let e=(0,l.e)();await e.auth.signOut(),window.location.href="/"}},80389:function(e,t,a){a.d(t,{r:function(){return s}});var r=a(37821),n=a(58078);let s=e=>{let{id:t,className:a="",...s}=e,l=(0,n.useId)();return(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{type:"checkbox",className:"sr-only",id:null!=t?t:l,...s}),(0,r.jsx)("label",{htmlFor:null!=t?t:l,className:"\n          flex-none w-10 h-6 bg-gray-400 [:checked+&]:bg-blue-500\n          rounded-full relative appearance-none\n          cursor-pointer transition-colors duration-200\n          before:block before:w-[18px] before:h-[18px] before:bg-white before:rounded-full\n          before:m-[3px] before:relative before:transition-transform before:duration-200\n          [:checked+&]:before:translate-x-4\n          [:disabled+&]:opacity-50 [:disabled+&]:pointer-events-none\n          ".concat(a,"\n        ")})]})}}}]);
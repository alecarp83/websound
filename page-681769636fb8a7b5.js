!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="260049bb-48a7-408a-bad8-c452e16ec55f",e._sentryDebugIdIdentifier="sentry-dbid-260049bb-48a7-408a-bad8-c452e16ec55f")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[202],{97737:function(e,t,n){Promise.resolve().then(n.bind(n,92627)),Promise.resolve().then(n.bind(n,90384))},92627:function(e,t,n){"use strict";n.d(t,{BrowserProviders:function(){return l}});var r=n(37821),i=n(18712),a=n(22257);function l(e){return(0,r.jsx)(i.Ym,{children:(0,r.jsx)(a.RV,{children:e.children})})}},90384:function(e,t,n){"use strict";n.d(t,{Browser:function(){return eR}});var r=n(37821),i=n(91341),a=n(77377),l=n(88202),s=n(92268),o=n(46587),u=n(75380),d=n(27950);let c=(0,n(85922).k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",17);var h=n(27624),f=n(58078);let m=(0,f.createContext)(null);var x=n(75005);async function v(e){let t=(0,x.e)();console.log(e),await t.auth.signInWithOAuth({provider:"google",options:{queryParams:{access_type:"online",prompt:"select_account"},redirectTo:"".concat(window.location.origin,"/auth/callback?next=").concat(e)}})}var g=n(11696),p=n(73164),w=n(68955),b=n(72056),y=n(84578),j=n.n(y),k=n(90168),C=n(54383),N=n(53644),P=n(46302),I=n(59264),E=n(39565),L=n(64722),R=n(17344),S=n(77391),M=n(17363);function _(e){let{currentPage:t}=e,n=(0,f.useContext)(R.Ec),{data:i,error:a}=(0,M.E7)(null==t?void 0:t.id),{mutateAsync:l}=(0,M.qM)(),s=(0,f.useContext)(L.fP),o=async()=>{if(!n){v(window.location.href);return}if(i&&(null==t?void 0:t.id)){let e=i.length?i[0]:await l({site_id:t.id,title:t.title,id:(0,I.A)()});(0,S.Me)(e.id),(0,S.YD)(e.id),j()()?(0,S.nP)(!0):s("open_persist")}},d=!(null==t?void 0:t.id)||!!(null==t?void 0:t.id)&&(0,u.kM)(t.id);return(0,r.jsx)("button",{className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1 rounded-full disabled:opacity-50 disabled:bg-none dark:hover:enabled:bg-neutral-600 ml-1 disabled:opacity-20 disabled:cursor-default",disabled:d,"aria-label":"Bookmark this page",title:"Bookmark this page",type:"button",onClick:o,children:(0,r.jsx)(E.Z,{className:"\n          w-6 h-6\n          ".concat((null==i?void 0:i.length)?"stroke-yellow-400 fill-yellow-400 dark:stroke-sky-400 dark:fill-sky-400":"","\n        ")})})}var T=n(98448),U=n(56942),D=n(39089),O=n(71786),z=n(87601),A=n(77362),F=n(18151);function Z(e){let t=(0,z.useQueryClient)(),n=(0,x.$)(),i=(0,f.useContext)(R.Ec),a=["likes",e.siteId],{data:l,error:s}=(0,A.useQuery)({queryKey:a,queryFn:async()=>{var t,r;let{data:a}=await n.from("likes").select("id,site_id").eq("site_id",null!==(t=e.siteId)&&void 0!==t?t:"").eq("user_id",null!==(r=null==i?void 0:i.id)&&void 0!==r?r:"").maybeSingle();return a},enabled:!!i&&!!e.siteId}),o=!!(null==l?void 0:l.site_id),{mutateAsync:d}=(0,F.useMutation)({async mutationFn(){let{data:t,error:r}=await n.from("likes").insert({site_id:e.siteId||""}).single();if(r)throw Error(r.message);return fetch("https://images.websim.ai/v1/site/".concat(e.siteId,"/1200.jpeg")).then(()=>{}).catch(e=>{console.error("Error from image creation",e)}),t},onMutate(){t.setQueryData(a,{site_id:e.siteId})},onSuccess(){t.invalidateQueries({queryKey:a})}}),{mutateAsync:c}=(0,F.useMutation)({async mutationFn(){if(!(null==l?void 0:l.id))return;let{data:e,error:t}=await n.from("likes").delete().eq("id",null==l?void 0:l.id).single();if(t)throw Error(t.message);return e},onMutate(){t.setQueryData(a,{})},onSuccess(){t.invalidateQueries({queryKey:a})}}),h=async()=>{if(!i){v(window.location.href);return}o?await c():await d()},m=!1;e.siteId&&(m=(0,u.kM)(e.siteId));let g=!e.siteId||m;return(0,r.jsx)("button",{className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1 rounded-full disabled:opacity-50 disabled:bg-none dark:hover:enabled:bg-neutral-600 ml-1 disabled:opacity-20 disabled:cursor-default",disabled:g,"aria-label":"Like",title:"Like",type:"button",onClick:h,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:o?"currentColor":"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-label":"Like",className:["w-6 h-6",o?"text-red-500 dark:text-teal-200":""].join(" "),children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"})})})}var B=n(23133),H=n(22449),W=n(18712),q=n(22257);function G(e){let{iframeRef:t,setLoading:n,loading:i,navigatingRef:a,refreshPage:l,goHome:u,newTabMode:d}=e,c=(0,h.Iq)(),m=(0,O.Wo)(),x=(0,O.Yz)();(0,O.$n)();let v=(0,f.useContext)(O.NT),g=(0,f.useContext)(W.fz),p=(0,f.useContext)(q.Bg),w=(0,f.useContext)(O.wC),b=(0,f.useContext)(O.vr),y=(0,f.useContext)(O.Tl),j=(0,f.useContext)(O.RJ),k=()=>{m&&!m.id&&(b(y.slice(0,-1)),w(y.length-2)),n(!1),a.current=!1,p(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{if(i&&!(null==m?void 0:m.id)){k();return}if(null==x?void 0:x.id){var e;let{url:t,id:n}=x;g(t),new URL("/api/html",window.location.origin).searchParams.set("id",n),w(v-1);let r=new URLSearchParams(window.location.search);r.has("b")&&(r.set("b",""),window.history.replaceState({},"","".concat(window.location.pathname,"?").concat(r.toString()))),null===(e=j.current)||void 0===e||e.call(j,n),p(!1)}},className:"hover:enabled:bg-gray-200 p-2 transition-all duration-300 ease-in-out rounded-full ml-2 disabled:opacity-50","aria-label":"Go Back",disabled:!x,children:(0,r.jsx)(H.Z,{className:"w-5 h-5"})}),i?(0,r.jsx)("button",{onClick:k,className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-2 rounded-full","aria-label":"Cancel Load",children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M12.8536 2.85355C13.0488 2.65829 13.0488 2.34171 12.8536 2.14645C12.6583 1.95118 12.3417 1.95118 12.1464 2.14645L7.5 6.79289L2.85355 2.14645C2.65829 1.95118 2.34171 1.95118 2.14645 2.14645C1.95118 2.34171 1.95118 2.65829 2.14645 2.85355L6.79289 7.5L2.14645 12.1464C1.95118 12.3417 1.95118 12.6583 2.14645 12.8536C2.34171 13.0488 2.65829 13.0488 2.85355 12.8536L7.5 8.20711L12.1464 12.8536C12.3417 13.0488 12.6583 13.0488 12.8536 12.8536C13.0488 12.6583 13.0488 12.3417 12.8536 12.1464L8.20711 7.5L12.8536 2.85355Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})})}):(0,r.jsxs)("button",{onClick:l,className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-2 rounded-full","aria-label":"Refresh Page",disabled:!c,children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),d&&(0,r.jsxs)("span",{className:"text-[8px] absolute -translate-x-1/2 text-gray-500 dark:text-neutral-200",children:[" ","new tab â†—"]})]}),(0,r.jsx)("button",{onClick:u,className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-2 rounded-full disabled:opacity-50","aria-label":"Go Home",title:"Home",disabled:c===o._w||c===s.XN,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})})})]})}let V=(0,f.createContext)(null);var K=n(84971),Q=n(8862),J=n(24887),X=n(71378),$=n(51146),Y=n(16612);function ee(e){(0,f.useContext)(h.bZ);let[t,n]=(0,f.useState)(!1),i=()=>{e.siteId&&navigator.clipboard.writeText("https://websim.ai/c/".concat(e.siteId))},a=(0,Q.h)(),l=async()=>{if(e.siteId)try{let t=await a.html.getSiteHtmlById({params:{site_id:e.siteId},query:{raw:!0}});if(200!==t.status)throw t;let n=URL.createObjectURL(new Blob([t.body],{type:"text/html"})),r="".concat(e.siteId,".html"),i=document.createElement("a");i.href=n,i.download=r,document.body.appendChild(i),i.click(),URL.revokeObjectURL(n),document.body.removeChild(i)}catch(e){console.error("Failed to download file:",e)}},s=!1;return e.siteId&&(s=(0,u.kM)(e.siteId)),(0,r.jsxs)(J.v2,{as:"div",className:"relative",children:[(0,r.jsx)(J.v2.Button,{className:["ml-1 hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1","dark:hover:enabled:bg-neutral-600","rounded-full disabled:opacity-50 disabled:bg-none",e.siteId?"":"opacity-20 cursor-default"].join(" "),"aria-label":"share",disabled:!e.siteId||s,children:(0,r.jsx)(X.Z,{className:" w-5 h-5 "})}),(0,r.jsxs)(J.v2.Items,{className:"absolute top-full right-0 mt-2 py-2 w-36 bg-white rounded-md shadow-xl z-20",children:[(0,r.jsx)(J.v2.Item,{children:e=>{let{active:t}=e;return(0,r.jsxs)("button",{className:["px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left flex items-center",t?"bg-gray-100":""].join(" "),onClick:i,children:[(0,r.jsx)($.Z,{className:"w-5 h-5 mr-2"}),"Copy URL"]})}}),(0,r.jsx)(J.v2.Item,{children:t=>{let{active:n}=t;return(0,r.jsxs)("button",{className:["px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left flex items-center",n?"bg-gray-100":""].join(" "),onClick:l,disabled:e.isLoading,children:[(0,r.jsx)(Y.Z,{className:"w-6 h-6 mr-2"}),"Download"]})}})]})]})}var et=n(8221),en=n(50366),er=n(64816),ei=n(3159),ea=n(34433),el=n(78781),es=n(290),eo=n(80997),eu=n(15685),ed=n(30675);function ec(e){let t=(0,k.usePathname)(),n=(0,eo.W)(t),{profile:i,following:a}=(0,D.i)(e.siteId),l=(0,f.useContext)(R.Ti);return(null==n?void 0:n.type)==="profile"?(0,r.jsx)(eh,{username:n.username}):e.siteId&&((0,u.kM)(e.siteId)||e.useCurrentUser)?(0,r.jsx)(eu.q,{user:null!=l?l:void 0,following:a}):(null==i?void 0:i.username)?(0,r.jsx)(eu.q,{user:i,following:a}):(0,r.jsx)(eu.q,{user:void 0,following:!1})}let eh=e=>{var t,n;let{username:i}=e,a=(0,ed.a)(i),{user:l,following:s}={user:null===(t=a.data)||void 0===t?void 0:t.user,following:(null===(n=a.data)||void 0===n?void 0:n.followed_at)!==void 0};return(0,r.jsx)(eu.q,{user:l,following:s})};function ef(){let e=(0,Q.h)(),{data:t,refetch:n}=(0,A.useQuery)({queryKey:["userUsage"],queryFn:async()=>{let t=await e.usage.getCurrentUserUsage();if(200!==t.status)throw t;return t.body}});return[t,n]}function em(){let[e]=ef();if(!e)return null;let{usage:t,limit:n}=e,i=n-t,a=t/n;if(a<.6)return null;let l="opacity-50";a>.85&&(l="text-orange-700");let s="".concat(i," runs remaining today");return i<=0&&(s="Your usage limit has been reached for today"),(0,r.jsx)("span",{className:["text-xs  ",l].join(" "),children:s})}function ex(e){var t;let n=null!==(t=e.index)&&void 0!==t?t:Math.floor(3*Math.random());return(0,r.jsx)("div",{...e,className:"relative h-24 w-24 ".concat(n%3==0?"rotate-2":n%3==1?"-rotate-2":"-rotate-1"," hover:rotate-0 transition-transform duration-300 shadow-md rounded-lg ").concat(e.className||""),children:e.children})}function ev(e){return(0,r.jsx)("button",{className:"absolute -top-1 -right-1 text-xs text-gray-400 hover:text-gray-600 bg-white hover:opacity-80 p-1 rounded-full border border-gray-200",type:"button",onClick:e.onClick,children:(0,r.jsx)(er.Z,{className:"w-3 h-3 text-gray-800 pointer-events-none"})})}function eg(e){return(0,r.jsx)("div",{className:"flex flex-row gap-6",children:e.attachments.map((e,t)=>(0,r.jsx)(ep,{file:e,index:t},e.id))})}function ep(e){let t=null;return e.file.mediaType.startsWith("image/")&&(t=(0,r.jsx)(ew,{file:e.file,index:e.index})),(0,r.jsx)("div",{className:"flex flex-col gap-2 pt-4 relative",children:t})}function ew(e){return(0,r.jsxs)(ex,{index:e.index,children:[(0,r.jsx)("img",{className:"object-cover w-full h-full rounded-lg",src:"/omegabus/attachment/".concat(e.file.id),alt:e.file.id}),(0,r.jsx)(eb,{id:e.file.id})]})}function eb(e){let t=(0,W.cS)();return(0,r.jsx)(ev,{onClick:n=>{n.preventDefault(),t(e.id)}})}var ey=n(38295);function ej(e){var t,n;let i=(0,f.useContext)(q.AW),a=(0,f.useContext)(q.Ao),l=(0,f.useContext)(q.qm),s=(0,f.useContext)(q.Bg),o=(0,f.useContext)(W.Tf),u=(0,f.useContext)(W.fz),d=(0,f.useContext)(R.Ec),c=(0,f.useContext)(h.cC),m=(0,f.useContext)(h.DE);(0,k.useSearchParams)().get("image_prompting"),(0,f.useEffect)(()=>{let e=e=>{if("l"===e.key&&(e.metaKey||e.ctrlKey)){var t,n;e.preventDefault(),null===(t=a.current)||void 0===t||t.focus(),null===(n=a.current)||void 0===n||n.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]);let x=(0,W.Nr)(),g=(0,f.useContext)(V),{mutateAsync:p}=(0,W.HL)(),w=(0,f.useContext)(B.n8),b=(0,f.useContext)(h.pV),y=(0,f.useContext)(h.Pb),C=!b&&y===(null==d?void 0:d.id)&&(null==m?void 0:null===(n=m.debug)||void 0===n?void 0:null===(t=n.messages)||void 0===t?void 0:t.some(e=>{var t;let n;return"assistant"===e.role&&(t=e.content,n=0,new en._b({onopentag:(e,t)=>{n++},onclosetag:e=>{n--}}).write(t),n>0)})),N=function(e){let[t,n]=(0,f.useState)(!1),r=(0,f.useContext)(W.fz);return(0,f.useEffect)(()=>{t&&(e(),n(!1))},[t,e]),(0,f.useCallback)(()=>{r("!continue"),n(!0)},[r])}(e.submit);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 h-full w-full aria-hidden:hidden z-[1]","aria-hidden":!l,onClick:e=>{e.preventDefault(),s(!1)}}),(0,r.jsx)("div",{className:["z-20",j()()?"":"absolute","w-full z-[2]",j()()&&l?"fixed h-[100vh] w-[100vw] top-0 left-0 right-0":"",j()()&&l?"bg-white dark:bg-neutral-900":"",j()()&&l?"overflow-auto":""].join(" "),ref:i,children:(0,r.jsxs)("div",{className:[l?"ring-1 ring-gray-200/50 dark:ring-neutral-50/20":"",j()()&&l?"pt-10 pb-20":"",!j()()&&l?"overflow-y-auto rounded-lg bg-white dark:bg-neutral-900 shadow-lg p-3 -m-3":""].join(" "),children:[j()()&&(0,r.jsxs)("div",{className:"absolute top-0 right-0 left-0 m-4 flex items-center aria-hidden:hidden","aria-hidden":!l,children:[(0,r.jsx)("div",{className:"flex-1 flex flex-row items-center gap-2",children:g}),(0,r.jsx)("button",{className:" flex items-center justify-center w-6 h-6 bg-gray-100 text-gray-800 font-bold p-1 rounded dark:bg-neutral-500 dark:text-neutral-100 ",onClick:e=>{e.preventDefault(),s(!1)},type:"button",children:(0,r.jsx)(er.Z,{className:"w-4 h-4 pointer-events-none"})})]}),(0,r.jsxs)("div",{className:["flex flex-col gap-2 relative",j()()?"":"max-h-[calc(100vh-8rem)]",j()()&&l?"px-2 pt-2":""].join(" "),children:[(0,r.jsx)("div",{className:[l&&j()()?"mt-3 -mb-2":"","transition-all duration-100 ease-in-out","p-1 box-border min-w-0 w-full",l?"bg-gray-200/80 dark:bg-neutral-800":"bg-white dark:bg-neutral-900","z-0",l?"rounded-lg":"rounded-3xl","mb-1"].join(" "),children:(0,r.jsxs)("div",{className:"flex flex-col gap-1 flex-1",children:[(0,r.jsxs)("div",{className:"flex flex-row items-start gap-2",children:[(0,r.jsx)(ec,{siteId:c,useCurrentUser:l}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 flex-1",children:[(0,r.jsx)(eC,{name:"url","aria-label":"URL",value:o,onChange:e=>u(e.currentTarget.value),className:["w-full bg-transparent focus:outline-none text-mono p-0 m-0 resize-none overflow-hidden text-ellipsis break-all text-base/5","overflow-y-auto",l?"":"whitespace-nowrap","pt-[2px]"].join(" "),minRows:1,maxRows:l?14:1,ref:a,placeholder:"What would you like to create today?",onFocus:e=>{if(!d){v(window.location.href);return}e.target.select()},onMouseUp:e=>{s(!0)},onKeyDown:t=>{"Escape"===t.key&&m&&u(m.url),"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.submit())}}),l&&w&&w.attachments&&w.attachments.length>0&&(0,r.jsx)(eg,{attachments:w.attachments}),(0,r.jsx)("div",{className:["flex flex-col gap-2 aria-hidden:hidden","pt-4 text-gray-500 pl-[2px]",l?"":"hidden"].join(" "),"aria-hidden":!l})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[l&&(0,r.jsx)("button",{className:" text-gray-500 bg-white p-1 rounded-lg hover:opacity-70 dark:bg-neutral-500 dark:text-gray-100 ",onClick:e=>{e.preventDefault(),e.stopPropagation();let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=e=>{let t=e.target.files;if(!t||0===t.length){console.error("No files selected");return}let n=t[0],r=new FileReader;r.onload=async e=>{await p(e.target.result)},r.readAsDataURL(n)},t.click()},children:(0,r.jsx)(ei.Z,{className:"w-4 h-4 pointer-events-none"})}),l&&(0,r.jsx)("button",{className:"text-white bg-gray-500 p-1 rounded-lg hover:opacity-70 dark:bg-blue-500 dark:text-gray-100",children:(0,r.jsx)(ea.Z,{className:["w-4 h-4 transform transition-transform duration-50",e.newTabMode?"-rotate-45 -translate-y-px  translate-x-px ":""].join(" ")})}),C&&(0,r.jsx)("button",{className:"text-gray-800 bg-gray-200 rounded-lg hover:opacity-70 text-sm h-6 px-2 dark:text-gray-300 dark:bg-gray-700",onClick:()=>{N()},children:"Continue?"}),!l&&x&&(0,r.jsx)("div",{className:"flex flex-row items-center gap-2 h-6 w-4",children:(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full"})})]})]}),l&&(0,r.jsxs)("div",{className:"flex justify-between align-end",children:[(0,r.jsx)(ek,{}),(0,r.jsx)(em,{})]})]})}),(0,r.jsx)("div",{className:[l?"":"hidden"].join(" "),children:(0,r.jsx)(ey.Z,{})})]})]})})]})}function ek(){let e=(0,f.useContext)(W.jc),t=(0,f.useContext)(W.aX);return(0,r.jsxs)(el.Ph.Root,{value:e,onValueChange:t,defaultValue:"sonnet",children:[(0,r.jsx)(el.Ph.Trigger,{variant:"ghost",className:""}),(0,r.jsxs)(el.Ph.Content,{position:"popper",className:"z-10 group",children:[(0,r.jsxs)(el.Ph.Group,{children:[(0,r.jsx)(el.Ph.Label,{children:"Anthropic"}),(0,r.jsx)(el.Ph.Item,{value:"sonnet",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsxs)("span",{children:["Sonnet ",(0,r.jsx)("span",{className:"opacity-50",children:"3.5"})]}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Smartest & Fast"})]})})]}),(0,r.jsx)(el.Ph.Separator,{}),(0,r.jsxs)(el.Ph.Group,{children:[(0,r.jsx)(el.Ph.Label,{children:"OpenAI"}),(0,r.jsx)(el.Ph.Item,{value:"gpt-4o",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsx)("span",{children:"GPT-4o"}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Experimental"})]})})]}),(0,r.jsx)(el.Ph.Separator,{}),(0,r.jsxs)(el.Ph.Group,{children:[(0,r.jsx)(el.Ph.Label,{children:"Legacy models"}),(0,r.jsx)(el.Ph.Item,{value:"haiku",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsx)("span",{children:"Haiku"}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Fast"})]})}),(0,r.jsx)(el.Ph.Item,{value:"claude-3-sonnet",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsxs)("span",{children:["Sonnet ",(0,r.jsx)("span",{className:"opacity-50",children:"3"})]}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Balanced"})]})}),(0,r.jsx)(el.Ph.Item,{value:"opus",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsx)("span",{children:"Opus"}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Smart"})]})})]})]})]})}let eC=(0,f.forwardRef)(function(e,t){let{mutateAsync:n}=(0,W.HL)();return(0,r.jsx)(es.Z,{ref:t,...e,onPaste:e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(r)for(let t=0;t<r.length;t++){let i=r[t];if(-1!==i.type.indexOf("image")){e.preventDefault();let t=i.getAsFile(),r=new FileReader;if(r.onload=e=>{n(e.target.result)},!t)throw alert("unimplemented"),Error("No blob");r.readAsDataURL(t);break}}}})});class eN{stop(){var e;null===(e=this.worker)||void 0===e||e.terminate()}constructor(e,t){this.worker=null;let n=new Blob(["setInterval(() => postMessage(0), ".concat(t,");")]),r=URL.createObjectURL(n);this.worker=new Worker(r),this.worker.onmessage=e}}class eP{startFaviconAnimation(){var e;null===(e=this.interval)||void 0===e||e.stop(),this.interval=new eN(this.setFavicon,16)}stopFaviconAnimation(){var e;null===(e=this.interval)||void 0===e||e.stop()}constructor(){this.interval=null,this.ready=!1,this.a=0,this.setFavicon=()=>{if(!this.ctx)return;this.ctx.clearRect(0,0,32,32),this.ctx.resetTransform(),this.ctx.translate(16,16),this.ctx.rotate(this.a),this.ctx.translate(-16,-16),this.a-=.1,this.ready&&this.ctx.drawImage(this.faviconImg,0,0);let e=document.getElementById("swirl-favicon");e&&e.remove();var t=document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=this.canvas.toDataURL("image/x-icon"),t.id="swirl-favicon",document.getElementsByTagName("head")[0].appendChild(t)},this.faviconImg=new Image,this.faviconImg.src="/favicon.ico",this.faviconImg.crossOrigin="anonymous",this.ready=!1,this.faviconImg.onload=()=>{this.ready=!0},this.canvas=document.createElement("canvas"),this.canvas.width=32,this.canvas.height=32,this.ctx=this.canvas.getContext("2d")}}let eI=["https://twitter.com/websim_ai","https://discord.gg/websim","https://www.reddit.com/r/WebSim","https://discord.com/channels/1223113914271793282/1223511479043489873/1242269156221390848"];function eE(e){if(eI.includes(e))return{url:e,target:"_blank"};if("https://websim.ai/auth/login"===e)return{url:"/auth/login",target:"_self"};let t=function(e){let t=e.split("websim.ai");if(t.length<2)return;let n=t[0],r=t.slice(1).join("websim.ai");if(""===n||"https://"===n||"https://"===n)return"https://websim.ai".concat(r)}(e);if(t){if(e===s.BM)return{url:e,target:"_self"};if(/^https:\/\/websim\.ai\/c\/[a-zA-Z0-9]{17}(\?.*)?$/.test(t)){let e=eL(t);if(e)return{url:e,target:"_self"}}if(/^https:\/\/websim\.ai\/@\w+/.test(t)){let e=eL(t);if(e)return{url:e,target:"_self"}}}if(/^@\w+(\/.*)?$/.test(e)){let t=eL("https://websim.ai/".concat(e));if(t)return{url:t,target:"_self"}}}function eL(e){let t="";try{t=new URL(e).pathname}catch(t){console.log("Invalid URL:",e);return}return(0,g.l)(e=>{e.pathname=t})}function eR(e){var t,n,x,y,I,E,L,M,z;let A=(0,f.useRef)(e);A.current=e;let F=(0,f.useContext)(h.bZ),H=(0,f.useMemo)(()=>{if(e.id){let t=new URL("/api/v1/sites/".concat(e.id,"/html"),F);return t.searchParams.set("origin",window.location.origin),t.toString()}},[e.id,F]),Q=(0,k.useRouter)(),J=(0,p.O9)(),X=(0,f.useRef)(null),$=(0,f.useRef)(null),Y=(0,f.useRef)(!1),[en,er]=(0,h.r$)(),ei=(0,f.useRef)(en);ei.current=en;let[ea,el]=(0,f.useState)(""),es=(0,f.useContext)(O.Tl),eo=(0,f.useContext)(O.vr),eu=(0,f.useRef)(es);eu.current=es;let ed=(0,f.useContext)(O.NT),ec=(0,f.useContext)(O.wC),eh=(0,f.useRef)(ed);eh.current=ed;let em=(0,f.useContext)(O.RJ),ex=es[ed],ev=es[ed-1],eg=(0,f.useContext)(W.Ug),ep=(0,f.useContext)(W.E6),ew=(0,f.useRef)(null!==(t=null==ex?void 0:ex.title)&&void 0!==t?t:"");ew.current=null!==(n=null==ex?void 0:ex.title)&&void 0!==n?n:"";let eb=(0,f.useRef)(null!==(x=null==ex?void 0:ex.url)&&void 0!==x?x:"");eb.current=null!==(y=null==ex?void 0:ex.url)&&void 0!==y?y:"";let ey=(0,f.useContext)(W.fz),ek=(0,f.useContext)(q.qm),eC=(0,f.useMemo)(()=>new Map,[]),eN=(0,f.useMemo)(()=>new Map,[]),[eI,eL]=ef(),eR=(0,f.useContext)(P.Sg),eM=(0,f.useContext)(R.Ec),eU=(0,f.useRef)(eM);eU.current=eM,(0,f.useContext)(h.DE);let eD=(0,f.useRef)(ex);eD.current=ex;let eO=(0,f.useContext)(q.Ao),ez=null!==(I=(0,f.useContext)(W.jc))&&void 0!==I?I:"sonnet",eA=(0,f.useRef)(ez);eA.current=ez;let eF=(0,f.useContext)(B.n8),eZ=(0,f.useRef)(eF);eZ.current=eF;let eB=(0,f.useContext)(h.ze),eH=(0,f.useRef)(eB);eH.current=eB;let eW=(0,f.useContext)(m),eq=(0,f.useContext)(q.Bg),eG=(0,D.$)(),eV=(0,f.useContext)(R.Ti),eK=(0,f.useRef)(null);eK.current={loadPage:em.current,cacheProfileForSite:eG,currentUserProfile:{username:null!==(E=null==eV?void 0:eV.username)&&void 0!==E?E:"",avatarUrl:null!==(L=null==eV?void 0:eV.avatar_url)&&void 0!==L?L:""}},(0,f.useEffect)(()=>{if(null==eW?void 0:eW.title){document.title=eW.title;return}(null==ex?void 0:ex.title)&&(ex.id&&eN.set(ex.id,ex.title),document.title=ex.title)},[null==ex?void 0:ex.id,null==ex?void 0:ex.title,null==eW?void 0:eW.title,eN]);let eQ=(0,T.t)(),eJ=(0,f.useContext)(h.GO);(0,f.useEffect)(()=>{!function(e,t,n,r){let i=i=>{var a;if(!i.isTrusted)return;let l=r();if(l&&i.source===l&&(null===(a=i.data)||void 0===a?void 0:a.name)===e){let{id:e,fn:r,args:a}=i.data,s=n[r](...a);s&&"function"==typeof s.then?s.then(async n=>{l.postMessage({id:e,result:function e(t,n,r){if(t){if(t instanceof ReadableStream)return function(e,t,n){let r="stream:".concat(Math.random().toString(36).slice(2)),i=e.getReader();new TextDecoder;let a=e=>{let{done:l,value:s}=e;if(l){n.postMessage({id:r,result:{done:!0}},t);return}n.postMessage({id:r,result:{done:!1,value:s}},t,[s.buffer]),i.read().then(a)};return i.read().then(a),{__stream__:!0,id:r}}(t,n,r);if(Array.isArray(t))return t.map(t=>e(t,n,r));if("object"==typeof t&&null!==t)return Object.fromEntries(Object.entries(t).map(t=>{let[i,a]=t;return[i,e(a,n,r)]}))}return t}(n,t,l)},t)},n=>{l.postMessage({id:e,error:n},t)}):l.postMessage({id:e,result:s},t)}};window.addEventListener("message",i),()=>{window.removeEventListener("message",i)}}("parent",F,{setLoaded:()=>{er(!1)},setProgress:e=>{el(t=>t+e)},setReady:e=>{let{id:t,version:n,title:r,url:s,method:o,body:c,command:h}=e;if(n&&eJ&&n!==eJ){window.location.reload();return}if(Y.current=!1,!t||!s)return;let f={id:t,url:s,title:r,method:o,body:c,command:h,debug:{messages:[{id:"".concat(t,"-user"),role:"user",content:"GET"===o?(0,d.ZD)(s):"POST"===o?(0,d.tk)(s,c):(0,d.RH)(null!=h?h:"")}]}};eR({messages:es.flatMap(e=>{var t,n;return null!==(n=null===(t=e.debug)||void 0===t?void 0:t.messages)&&void 0!==n?n:[]})}),f.title||(f={...f,title:(0,i.v)(f.url)}),f.id&&eN.has(f.id)&&(f={...f,title:eN.get(f.id)}),ew.current=f.title,eb.current=f.url,eo([...eu.current.slice(0,eh.current),f,...eu.current.slice(eh.current+1)]);let m=(0,a.l9)(f.url);if(f.id&&!(0,u.kM)(f.id)&&ey(m),t!==l.j){let e=(0,u.kM)(t)?(0,g.l)(e=>{e.pathname="/"}):(0,g.l)(e=>{e.pathname=(0,g.z)(f.id)});window.location.href!==e&&window.history.pushState({},"",e)}f.id&&eQ({id:f.id,created_at:new Date().toISOString(),title:f.title,url:f.url})},getFetchParams:async()=>({websimUpdateVersion:0}),navigate:async e=>{var t,n,r;let{method:a,url:l,target:s,body:o,command:u}=e,h="_blank"===s&&"opus"!==eA.current;if("GET"===a&&l){let{url:e,target:t}=null!==(n=eE(l))&&void 0!==n?n:{};if(e){"_blank"===t||h?window.open(e,"_blank"):Q.push(e);return}}if(!ei.current&&!Y.current){if(!eU.current){v(window.location.href);return}if(null===(t=eD.current)||void 0===t?void 0:t.id){l||(l=eD.current.url);let e={currentId:null===(r=eD.current)||void 0===r?void 0:r.id,promptSource:"page",apiKey:(0,U.Pi)(),model:eA.current,siteId:c(),lore:eZ.current};h||(eo([...eu.current.slice(0,eh.current+1),{id:e.siteId,url:l,title:(0,i.v)(l),method:a,body:o,debug:{messages:[{id:"".concat(e.siteId,"-user"),role:"user",content:"GET"===a?(0,d.ZD)(l):"POST"===a?(0,d.tk)(l,o):(0,d.RH)(null!=u?u:"")}]}}]),ec(eh.current+1),ey(l),er(!0),Y.current=!0),"eval"===a&&await eS({method:a,command:null!=u?u:"",...e},eK.current,eL,h),"GET"===a&&await eS({method:a,url:l,...e},eK.current,eL,h),"POST"===a&&await eS({method:a,url:l,body:o,...e},eK.current,eL,h)}}},reload:()=>{e$()},setHash:e=>{let t="".concat(eD.current.url.split("#")[0]).concat(e);ey(t),eo([...eu.current.slice(0,eh.current),{...eu.current[eh.current],url:t},...eu.current.slice(eh.current+1)])},setTitle:e=>{ew.current=e,eo([...eu.current.slice(0,eh.current),{...eu.current[eh.current],url:eb.current,title:e},...eu.current.slice(eh.current+1)])},focusUrl:()=>{var e;null===(e=eO.current)||void 0===e||e.focus()},login:()=>{v(window.location.href)},logout:()=>{e_()},saveHtml:async e=>{let{html:t,parent_id:n}=e,r=await fetch("/api/experimental/v0/site",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t,parent_id:n})});if(!r.ok)throw Error("Failed to save websim");let i=await r.json();return N.z.object({id:N.z.string()}).parse(i)},getHtml:async e=>{let t=await fetch("/api/experimental/v0/site/".concat(e),{method:"GET"});if(!t.ok)throw Error("Failed to load websim html");let n=await t.json(),{content:r}=N.z.object({content:N.z.string()}).parse(n);return r},generateImage:async e=>{let t=await fetch("/api/image_gen",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Error: ".concat(t.status));let n=await t.json();return N.z.object({url:N.z.string(),rewritten_prompt:N.z.string()}).parse(n)},getPlugins(){let e=new URLSearchParams(window.location.search).getAll("plugin"),t=window.location.origin;return Promise.all(e.map(async e=>{let n=new URL("/api/v1/sites/".concat(e.replace(/^@/,""),"/html"),F);return n.searchParams.set("origin",window.location.origin),(await fetch(n).then(e=>{if(!e.ok)throw Error("Failed to load plugin");return e.text()})).replaceAll("https://websim.ai",t)}))},getParams:()=>Promise.resolve({pathname:window.location.pathname}),fetchApi:async e=>{let{url:t,options:n}=e;if(!eU.current)return v(window.location.href),{status:401,statusText:"Unauthorized",headers:{},body:null};let r=new URL("/api/fetch",window.origin);r.searchParams.set("url",t);let i=await fetch(r,{...n,credentials:"include"});return 400===i.status&&"true"===i.headers.get("X-Websim-Client-Outdated")&&window.confirm("A new version of the Websim client is available. Refresh?")&&window.location.reload(),{status:i.status,statusText:i.statusText,headers:Object.fromEntries(i.headers.entries()),body:i.body}},getUser:async()=>eV?((0,C.Z)(eV.username,"User has no username"),{id:eV.id,username:eV.username,avatar_url:eV.avatar_url}):null},()=>{var e;return null===(e=X.current)||void 0===e?void 0:e.contentWindow})},[]),(0,f.useEffect)(()=>{let t=t=>{"hidden"===document.visibilityState&&eT(e.view_uuid)};return window.addEventListener("visibilitychange",t),()=>{window.removeEventListener("visibilitychange",t)}},[e]);let eX=t=>{t!==eY&&(eT(e.view_uuid),eC.get(t)&&A.current.html,er(!0),new URL("/api/v1/sites/".concat(t,"/html"),F).searchParams.set("origin",window.location.origin),Y.current=!0,Q.push((0,g.l)(e=>{e.pathname=(0,g.z)(t)})))};em.current=eX,(0,f.useEffect)(()=>{el(""),en?(window.favicon||(window.favicon=new eP),window.favicon.startFaviconAnimation()):(window.favicon||(window.favicon=new eP),window.favicon.stopFaviconAnimation())},[en]);let e$=async()=>{if(ex){if(!eM){v(window.location.href);return}let{url:e,method:t,body:n,command:r}=ex,a={currentId:null==ev?void 0:ev.id,url:e,body:n,apiKey:(0,U.Pi)(),model:eA.current,siteId:c(),lore:eH.current};eg||(ey(e),eo([...es.slice(0,ed+1),{id:a.siteId,url:e,title:(0,i.v)(e),method:t,body:n,command:r,debug:{messages:[{id:"".concat(a.siteId,"-user"),role:"user",content:"GET"===t?(0,d.ZD)(e):"POST"===t?(0,d.tk)(e,n):(0,d.RH)(null!=r?r:"")}]}}]),er(!0),Y.current=!0,new URLSearchParams(window.location.search)),"eval"===t?await eS({method:t,command:null!=r?r:"",...a},eK.current,eL,eg):await eS({method:t,...a},eK.current,eL,eg)}},eY=(0,h.Iq)();(0,f.useEffect)(()=>{eY&&!A.current.html&&(er(!0),Y.current=!0)},[]);let e0=(0,p.HV)(),[e1,e2]=(0,f.useState)(!1),e5=(0,f.useContext)(h.Pb),e3=(0,r.jsx)(G,{iframeRef:X,setLoading:er,loading:en,navigatingRef:Y,refreshPage:e$,goHome:()=>{eo([]),ec(0),eX(eM?o._w:s.XN)},newTabMode:eg});return(0,r.jsx)(V.Provider,{value:e3,children:(0,r.jsxs)("div",{id:"browser",className:["@container bg-clip-padding relative flex-1 flex flex-col items-stretch","ring-1 ring-gray-200/50 dark:ring-neutral-50/20","bg-white dark:bg-neutral-950",J?"":"rounded-lg"].join(" "),children:[e0?(0,r.jsx)("div",{className:"absolute h-[1px] w-full top-0 left-0 z-10",onMouseEnter:()=>{e2(!0)}}):null,(0,r.jsxs)("div",{className:["flex flex-col items-stretch w-full bg-gray-100 dark:bg-neutral-700",j()()?"fixed z-10 top-0":"",e0?"":j()()?"":"rounded-t-lg",e0&&!e1?"hidden":"",e0&&e1?"absolute z-10":""].join(" "),children:[(0,r.jsxs)("div",{className:["p-[6px] flex items-center justify-between h-[44px] gap-2",j()()?"pt-0":""].join(" "),children:[(0,r.jsxs)("div",{className:"flex flex-1 items-center justify-start ".concat(j()()?"hidden":""),children:[(0,r.jsxs)("div",{className:"hidden @lg:flex",children:[(0,r.jsx)("div",{className:"bg-red-500 dark:bg-teal-200 h-3 w-3 rounded-full mx-1"}),(0,r.jsx)("div",{className:"bg-yellow-400 dark:bg-sky-400 h-3 w-3 rounded-full mx-1"}),(0,r.jsx)(w.z,{onClick:()=>{let e=(0,p.fk)();(0,p.kL)(!e)},children:(0,r.jsx)("div",{className:"bg-green-500 dark:bg-pink-300 h-3 w-3 rounded-full mx-1 flex items-center justify-center group",children:(0,r.jsxs)("svg",{width:"6",height:"7",viewBox:"0 0 6 7",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-2 h-2 group-hover:opacity-50 opacity-0",children:[(0,r.jsx)("path",{d:"M0.5 4V1H3.5L0.5 4Z",fill:"black"}),(0,r.jsx)("path",{d:"M5.5 3L2.5 6H5.5V3Z",fill:"black"}),(0,r.jsx)("path",{d:"M0.5 4V1H3.5L0.5 4Z",stroke:"black"}),(0,r.jsx)("path",{d:"M5.5 3L2.5 6H5.5V3Z",stroke:"black"})]})})})]}),!j()()&&e3]}),j()()?null:(0,r.jsx)("div",{className:"flex flex-grow-1 flex-shrink-1 items-center justify-center basis-[800px]",children:e4()}),(0,r.jsxs)("div",{className:"flex flex-1 items-center ".concat(j()()?"justify-between":"justify-end"),children:[j()()&&(0,r.jsx)("button",{onClick:()=>{(0,S.nP)(!0)},className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1 rounded-full disabled:opacity-50 disabled:bg-none",children:(0,r.jsx)(b.Z,{className:"w-5 h-5"})}),(0,r.jsx)(K.Zr,{}),(0,r.jsx)(et.sX,{siteId:null!=eY?eY:null}),e5!==(null==eM?void 0:eM.id)&&!(0,u.kM)(eY)&&(0,r.jsx)(Z,{siteId:null!==(M=null==ex?void 0:ex.id)&&void 0!==M?M:null,isLoading:!1}),e5===(null==eM?void 0:eM.id)&&!(0,u.kM)(eY)&&(0,r.jsx)(_,{currentPage:ex}),!(0,u.kM)(eY)&&(0,r.jsx)(ee,{siteId:null!==(z=null==ex?void 0:ex.id)&&void 0!==z?z:null,isLoading:!1})]})]}),j()()?(0,r.jsx)("div",{className:"p-2 flex items-center justify-between h-12 flex-0 -mt-4",children:e4()}):null]}),(0,r.jsxs)("div",{className:["flex-1 absolute left-0 right-0 bottom-0 overflow-hidden",j()()?"top-[76px]":"6",e0?"top-0":"top-11"].join(" "),onMouseEnter:()=>{e2(!1)},children:[(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("div",{className:["bg-blue-500 absolute left-0 z-[1] min-w-16 transition-width transition-opacity",e0&&e1?"top-11":"top-0",""===ea?"animate-pulse ":""].join(" "),style:{opacity:en?1:0,padding:en?2:0,width:100-100/(1+ea.length/500)+"%"}}),en&&(0,r.jsx)("div",{className:"bg-blue-500 absolute -top-0 flex whitespace-nowrap justify-end left-0 z-[1] text-white text-xs h-0 group-hover:h-4 overflow-hidden cursor-default	",style:{transition:"height 0.1s ease-in-out",width:ea.length>0?"100%":"auto"},children:ea||"Initializing..."})]}),(0,r.jsx)("iframe",{ref:X,src:H,srcDoc:e.html,name:"contentWindow",allow:"accelerometer *; bluetooth *; camera *; encrypted-media *; display-capture *; geolocation *; gyroscope *; microphone *; midi *; clipboard-read *; clipboard-write *; serial *; xr-spatial-tracking *; fullscreen *; payment *",className:[ek?"pointer-events-none":"","absolute inset-0 w-full h-full bottom-0 border-none delay-500 bg-white dark:bg-neutral-900",J?"":"rounded-b-lg"].join(" "),onLoad:()=>{var e,t,n,r,i,a;null==X||null===(n=X.current)||void 0===n||null===(t=n.contentDocument)||void 0===t||null===(e=t.body)||void 0===e||e.addEventListener("keydown",e=>{ep(e.metaKey)}),null==X||null===(a=X.current)||void 0===a||null===(i=a.contentDocument)||void 0===i||null===(r=i.body)||void 0===r||r.addEventListener("keyup",e=>{ep(e.metaKey)}),er(!1),Y.current=!1},onAbort:()=>{er(!1),Y.current=!1},onError:()=>{er(!1),Y.current=!1}})]})]})});function e4(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("form",{ref:$,action:"/api/html",method:"POST",className:"flex-grow relative",onSubmit:async e=>{var t,n;if(e.preventDefault(),!eU.current){v(window.location.href);return}if(en||!(null==ex?void 0:ex.id))return;let r=eO.current.value.trim();if(!r)return;let{url:a,target:l}=null!==(t=eE(r))&&void 0!==t?t:{};if(a&&"_blank"===l){window.open(a,"_blank");return}if(a){Q.push(a);return}let s={apiKey:(0,U.Pi)(),model:eA.current,lore:eZ.current,promptSource:"url-bar",siteId:c()};if(e.preventDefault(),eg||(null===(n=X.current)||void 0===n||n.focus(),er(!0),Y.current=!0),r.includes("\n")?1:/^\w+:\/\//i.test(r)?0:/\.[^/]+/.test(r)?r.includes(" "):1)eg||(eo([...es.slice(0,ed+1),{...ex,id:s.siteId,url:"",title:"",command:r,debug:{messages:[{id:"".concat(s.siteId,"-user"),role:"user",content:(0,d.RH)(r)}]}}]),ec(ed+1)),await eS({currentId:ex.id,command:r,method:"eval",...s},eK.current,eL,eg);else{let e;if(!eg){let e=(0,i.v)(r);eo([...es.slice(0,ed+1),{url:r,title:e,method:"GET",id:s.siteId,debug:{messages:[{id:"".concat(s.siteId,"-user"),role:"user",content:(0,d.ZD)(r)}]}}]),ec(ed+1),document.title=(0,i.v)(r)}await eS({currentId:ex.id,url:(e=r,/^\w+:\/\//i.test(e)||(e="https://".concat(e)),e),method:"GET",...s},eK.current,eL,eg)}eg||eq(!1)},children:(0,r.jsx)("div",{className:"flex-1 h-8",children:(0,r.jsx)(ej,{newTabMode:eg,submit:()=>{var e;null===(e=$.current)||void 0===e||e.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}})})})})}}let eS=async function(e,t,n){var r,i;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=new URL(window.location.href),s={temperature:l.searchParams.get("temperature"),model:l.searchParams.get("model"),beta:"true"===l.searchParams.get("beta")},o={...e,apiKey:(0,U.Pi)(),beta:s.beta,model:null!==(r=s.model)&&void 0!==r?r:e.model,temperature:s.temperature?parseFloat(s.temperature):void 0};if(a){let e=eM(o),t="".concat(window.location.origin,"/c/").concat(o.siteId),r=window.open("about:blank","_blank");if(!r)return;(await e).ok&&(r.location.href=t),n();return}let u=await eM(o);n(),u.ok&&(null===(i=t.loadPage)||void 0===i||i.call(t,o.siteId),t.cacheProfileForSite(o.siteId,t.currentUserProfile))},eM=async e=>await fetch("/api/html",{method:"PUT",body:JSON.stringify(e),headers:{"content-type":"application/json"}});async function e_(){let e=(0,x.e)();await e.auth.signOut(),window.location.href="/"}async function eT(e){e&&navigator.sendBeacon("/api/end_view",JSON.stringify({view_uuid:e}))}},18712:function(e,t,n){"use strict";n.d(t,{Ug:function(){return N},Ym:function(){return I},jc:function(){return j},E6:function(){return P},aX:function(){return k},fz:function(){return w},Tf:function(){return p},cS:function(){return b},Nr:function(){return y},HL:function(){return E}});var r=n(37821),i=n(30520),a=n(14581),l=n(75380),s=n(27624),o=n(58078),u=function(){let[e,t]=(0,o.useState)(!1);function n(e){t(e.metaKey)}function r(){document.hidden&&t(!1)}return(0,o.useEffect)(()=>(window.addEventListener("keydown",n),window.addEventListener("keyup",n),window.addEventListener("visibilitychange",r),window.addEventListener("mousemove",n),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",n),window.removeEventListener("visibilitychange",r),window.removeEventListener("mousemove",n)}),[]),[e,t]},d=n(87601),c=n(18151),h=n(22920),f=n(17344),m=n(56942),x=n(71786),v=n(23133),g=n(59792);let p=(0,o.createContext)(void 0),w=(0,o.createContext)(void 0);function b(){let e=(0,o.useContext)(v.W7);return(0,o.useCallback)(t=>{e((0,h.Uy)(e=>{(null==e?void 0:e.attachments)&&(e.attachments=(0,h.Js)(e.attachments).filter(e=>e.id!==t))}))},[e])}function y(){let e=(0,o.useContext)(f.Ec),t=(0,x.Wo)(),n=(0,o.useContext)(p),r=(0,o.useContext)(j),i=(0,o.useContext)(s.JI),a=(0,o.useContext)(s.ze),u=(0,o.useContext)(v.n8);if(!e||!t)return!1;let d=[a&&a.attachments!==(null==u?void 0:u.attachments),t.id&&!(0,l.kM)(t.id)&&n!==C(t.url),i&&r!==i];return!!d.some(Boolean)||d.some(Boolean)}let j=(0,o.createContext)(void 0),k=(0,o.createContext)(null);function C(e){let t=window.location.origin;return e.replace(t,"https://websim.ai")}let N=(0,o.createContext)(!1),P=(0,o.createContext)(null);function I(e){let[t,n]=(0,o.useState)(""),i=(0,o.useMemo)(()=>C(t),[t]),a=(0,o.useCallback)(e=>{if(!g.env.IS_PRODUCTION_ENVIRONMENT){if("string"==typeof e){n(C(e));return}if("function"==typeof e){n(t=>C(e(t)));return}}n(e)},[n]),[d,c]=(0,o.useState)(void 0),h=(0,x.Wo)(),f=(0,s.M6)(),[b,y]=u(),[I,E]=(0,o.useState)(void 0),L=b&&"opus"===I?"sonnet":I;(0,o.useEffect)(()=>{h||c(void 0)},[h]);let R=(0,m.rV)(),[S]=(0,s.r$)();(0,o.useRef)().current=S,(0,o.useEffect)(()=>{if(f)E(f);else{var e;E(null!==(e=null==R?void 0:R.model)&&void 0!==e?e:void 0)}},[f,null==R?void 0:R.model]);let M=(0,o.useContext)(s.cC);return(0,o.useEffect)(()=>{if((0,l.kM)(M)){var e;E(null!==(e=null==R?void 0:R.model)&&void 0!==e?e:void 0)}},[M,null==R?void 0:R.model]),(0,r.jsx)(p.Provider,{value:i,children:(0,r.jsx)(w.Provider,{value:a,children:(0,r.jsx)(j.Provider,{value:L,children:(0,r.jsx)(k.Provider,{value:E,children:(0,r.jsx)(v.q4,{children:(0,r.jsx)(N.Provider,{value:b,children:(0,r.jsx)(P.Provider,{value:y,children:e.children})})})})})})})}function E(){let e=(0,o.useContext)(v.W7),t=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:async e=>{let t={id:(0,i.ad)(),dataUri:e},n=await fetch("/omegabus/attachment",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return i.Pg.parse(await n.json())},onSuccess:async n=>(t.setQueryData(["attachment",n.id],n),t.setQueryData(["attachments"],e=>e?[n,...e]:[n]),console.log("attachment",n),e(e=>{var t;return{...null!=e?e:(0,a.Cs)(),attachments:[...null!==(t=null==e?void 0:e.attachments)&&void 0!==t?t:[],{id:n.id,mediaType:n.mediaType}]}}),n)})}},22257:function(e,t,n){"use strict";n.d(t,{AW:function(){return a},Ao:function(){return l},Bg:function(){return s},RV:function(){return c},qm:function(){return o}});var r=n(37821),i=n(58078);let a=(0,i.createContext)(null),l=(0,i.createContext)(null),s=(0,i.createContext)(null),o=(0,i.createContext)(null),u=(0,i.createContext)(null),d=(0,i.createContext)(null);function c(e){let t=(0,i.useRef)(null),n=(0,i.useRef)(null),[c,h]=(0,i.useState)(!1),[f,m]=(0,i.useState)(!1);return(0,r.jsx)(u.Provider,{value:m,children:(0,r.jsx)(d.Provider,{value:f,children:(0,r.jsx)(a.Provider,{value:t,children:(0,r.jsx)(l.Provider,{value:n,children:(0,r.jsx)(s.Provider,{value:h,children:(0,r.jsx)(o.Provider,{value:c,children:e.children})})})})})})}}},function(e){e.O(0,[552,71,393,78,419,618,13,793,295,835,115,362,744],function(){return e(e.s=97737)}),_N_E=e.O()}]);